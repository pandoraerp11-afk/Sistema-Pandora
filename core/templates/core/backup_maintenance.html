{% extends "pandora_ultra_modern_base.html" %}
{% load static %}
{% load humanize %} {% block title %}Backup e Manutenção - Pandora ERP{% endblock %} {% block extra_css %}
{% endblock %} .maintenance-header::before { content: ''; position: absolute; top: -20%; right: -10%; width: 250px; height: 250px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; animation: rotate 15s linear infinite; } .backup-card { background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.4s ease; position: relative; overflow: hidden; height: 100%; } .backup-card:hover { transform: translateY(-8px); box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15); } .backup-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--card-accent, #10b981); } .backup-status { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; border-radius: 50px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 1rem; } .backup-status.success { background: rgba(16, 185, 129, 0.1); color: #059669; border: 1px solid rgba(16, 185, 129, 0.2); } .backup-status.running { background: rgba(59, 130, 246, 0.1); color: #2563eb; border: 1px solid rgba(59, 130, 246, 0.2); } .backup-status.error { background: rgba(239, 68, 68, 0.1); color: #dc2626; border: 1px solid rgba(239, 68, 68, 0.2); } .backup-status.scheduled { background: rgba(245, 158, 11, 0.1); color: #d97706; border: 1px solid rgba(245, 158, 11, 0.2); } .backup-icon { width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; margin-bottom: 1rem; } .backup-metric { font-size: 2rem; font-weight: 800; color: #1a202c; margin-bottom: 0.5rem; line-height: 1; } .backup-label { font-size: 0.875rem; color: #64748b; font-weight: 500; margin-bottom: 1rem; } .backup-progress { background: #f1f5f9; border-radius: 8px; height: 8px; overflow: hidden; margin: 1rem 0; } .backup-progress-fill { height: 100%; background: linear-gradient(90deg, var(--progress-color, #10b981), var(--progress-color-end, #059669)); border-radius: 8px; transition: width 0.5s ease; position: relative; } .backup-progress-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); animation: shimmer 2s infinite; } .backup-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; flex-wrap: wrap; } .backup-timeline { position: relative; padding-left: 2rem; margin-top: 2rem; } .backup-timeline::before { content: ''; position: absolute; left: 12px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, #667eea, #764ba2); } .backup-timeline-item { position: relative; margin-bottom: 2rem; background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06); border: 1px solid rgba(0, 0, 0, 0.05); margin-left: 1rem; } .backup-timeline-item::before { content: ''; position: absolute; left: -1.5rem; top: 1.5rem; width: 12px; height: 12px; border-radius: 50%; background: var(--timeline-color, #667eea); border: 3px solid white; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); } .maintenance-task { background: white; border-radius: 16px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06); border: 1px solid rgba(0, 0, 0, 0.05); transition: all 0.3s ease; } .maintenance-task:hover { transform: translateX(8px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); } .task-header { display: flex; justify-content: between; align-items: flex-start; margin-bottom: 1rem; } .task-info { flex: 1; } .task-title { font-weight: 700; color: #1a202c; margin-bottom: 0.25rem; } .task-description { color: #64748b; font-size: 0.875rem; margin-bottom: 0.5rem; } .task-schedule { display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; color: #6b7280; } .task-actions { display: flex; gap: 0.5rem; align-items: flex-start; } .storage-overview { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; } .storage-item { background: white; border-radius: 16px; padding: 1.5rem; text-align: center; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid rgba(0, 0, 0, 0.05); transition: all 0.3s ease; } .storage-item:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); } .storage-icon { width: 50px; height: 50px; border-radius: 12px; background: linear-gradient(135deg, var(--storage-color), var(--storage-color-dark)); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; margin: 0 auto 1rem; } .filter-panel { background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid rgba(0, 0, 0, 0.05); margin-bottom: 2rem; } @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } } .maintenance-mode-banner { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #92400e; border-radius: 16px; padding: 1rem 1.5rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem; box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3); } .maintenance-mode-banner.active { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; } .alert-icon { width: 40px; height: 40px; border-radius: 12px; background: rgba(255, 255, 255, 0.2);
{% endblock %} {% block content %}
<div class="container-fluid py-4"><!-- Breadcrumb --><div class="row mb-4"><div class="col-12"><nav aria-label="breadcrumb"><ol class="breadcrumb bg-white shadow-sm rounded-3 px-3 py-2 mb-0"><li class="breadcrumb-item"><a href="{% url 'dashboard' %}" class="text-decoration-none"><i class="fas fa-home"></i> Início </a></li><li class="breadcrumb-item active" aria-current="page"><i class="fas fa-tools"></i> Backup e Manutenção </li></ol></nav></div></div><!-- Header --><div class="maintenance-header" data-aos="fade-down"><div class="row align-items-center"><div class="col-lg-8"><h1 class="display-6 fw-bold mb-2"><i class="fas fa-tools me-3"></i> Backup e Manutenção </h1><p class="fs-5 mb-0 opacity-90"> Gerencie backups, manutenção e integridade do sistema </p></div><div class="col-lg-4 text-end"><div class="d-flex gap-3 justify-content-end"><button type="button" class="btn btn-light btn-lg rounded-pill" onclick="runSystemCheck()"><i class="fas fa-stethoscope me-2"></i> Verificar Sistema </button><button type="button" class="btn btn-warning btn-lg rounded-pill" onclick="createBackup()"><i class="fas fa-download me-2"></i> Backup Agora </button></div></div></div></div><!-- Maintenance Mode Banner --> {% if maintenance_mode %} <div class="maintenance-mode-banner active" data-aos="fade-up"><div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div><div class="flex-grow-1"><h6 class="fw-bold mb-1">Modo de Manutenção Ativo</h6><p class="mb-0">O sistema está em modo de manutenção. Usuários não têm acesso.</p></div><button type="button" class="btn btn-light btn-sm" onclick="toggleMaintenanceMode()"> Desativar </button></div> {% else %} <div class="maintenance-mode-banner" data-aos="fade-up"><div class="alert-icon"><i class="fas fa-info-circle"></i></div><div class="flex-grow-1"><h6 class="fw-bold mb-1">Sistema Operacional</h6><p class="mb-0">O sistema está funcionando normalmente.</p></div><button type="button" class="btn btn-outline-dark btn-sm" onclick="toggleMaintenanceMode()"> Ativar Manutenção </button></div> {% endif %} <!-- Backup Overview --><div class="row g-4 mb-4" data-aos="fade-up"><div class="col-lg-3 col-md-6"><div class="backup-card" data-card-accent="#10b981"><div class="backup-status success"><i class="fas fa-check"></i> Sucesso </div><div class="backup-icon bg-success"><i class="fas fa-database"></i></div><div class="backup-metric">{{ last_backup_size|default:"2.4 GB" }}</div><div class="backup-label">Último Backup</div><div class="text-muted small"><i class="fas fa-clock me-1"></i> {{ last_backup_time|default:"2 horas atrás" }} </div></div></div><div class="col-lg-3 col-md-6"><div class="backup-card" data-card-accent="#3b82f6"><div class="backup-status scheduled"><i class="fas fa-calendar"></i> Agendado </div><div class="backup-icon bg-primary"><i class="fas fa-clock"></i></div><div class="backup-metric">{{ next_backup|default:"22:00" }}</div><div class="backup-label">Próximo Backup</div><div class="text-muted small"><i class="fas fa-calendar me-1"></i> Hoje, backup automático </div></div></div><div class="col-lg-3 col-md-6"><div class="backup-card" data-card-accent="#f59e0b"><div class="backup-status running"><i class="fas fa-sync fa-spin"></i> Em Andamento </div><div class="backup-icon bg-warning"><i class="fas fa-cogs"></i></div><div class="backup-metric">{{ maintenance_tasks|default:"3" }}</div><div class="backup-label">Tarefas de Manutenção</div><div class="backup-progress"><div class="backup-progress-fill w-65" data-progress-color="#f59e0b" data-progress-end="#d97706"></div></div></div></div><div class="col-lg-3 col-md-6"><div class="backup-card" data-card-accent="#8b5cf6"><div class="backup-status success"><i class="fas fa-shield-check"></i> Saudável </div><div class="backup-icon bg-purple"><i class="fas fa-heartbeat"></i></div><div class="backup-metric">{{ system_health|default:"98%" }}</div><div class="backup-label">Integridade do Sistema</div><div class="text-muted small"><i class="fas fa-check me-1"></i> Todos os serviços OK </div></div></div></div><!-- Messages --> {% include "partials/messages.html" %} <!-- Storage Overview --><div class="storage-overview" data-aos="fade-up" data-aos-delay="100"><div class="storage-item"><div class="storage-icon" data-storage-color="#3b82f6" data-storage-dark="#2563eb"><i class="fas fa-server"></i></div><h6 class="fw-bold mb-2">Banco de Dados</h6><div class="backup-metric fs-3">{{ db_size|default:"1.8 GB" }}</div><div class="text-muted small">{{ db_growth|default:"+2% esta semana" }}</div></div><div class="storage-item"><div class="storage-icon" data-storage-color="#10b981" data-storage-dark="#059669"><i class="fas fa-file-archive"></i></div><h6 class="fw-bold mb-2">Arquivos</h6><div class="backup-metric fs-3">{{ files_size|default:"3.2 GB" }}</div><div class="text-muted small">{{ files_growth|default:"+5% esta semana" }}</div></div><div class="storage-item"><div class="storage-icon" data-storage-color="#f59e0b" data-storage-dark="#d97706"><i class="fas fa-history"></i></div><h6 class="fw-bold mb-2">Backups</h6><div class="backup-metric fs-3">{{ backups_size|default:"12.5 GB" }}</div><div class="text-muted small">{{ backup_count|default:"15 backups disponíveis" }}</div></div><div class="storage-item"><div class="storage-icon" data-storage-color="#8b5cf6" data-storage-dark="#7c3aed"><i class="fas fa-chart-line"></i></div><h6 class="fw-bold mb-2">Logs</h6><div class="backup-metric fs-3">{{ logs_size|default:"480 MB" }}</div><div class="text-muted small">{{ logs_retention|default:"30 dias de retenção" }}</div></div></div><!-- Maintenance Tasks and Backup History --><div class="row g-4 mb-4"><!-- Maintenance Tasks --><div class="col-lg-6"><div class="filter-panel" data-aos="fade-up" data-aos-delay="200"><h5 class="fw-bold mb-3"><i class="fas fa-tasks me-2 text-primary"></i> Tarefas de Manutenção </h5><div class="maintenance-task"><div class="task-header"><div class="task-info"><div class="task-title">Limpeza de Cache</div><div class="task-description">Remove arquivos de cache temporários e otimiza performance</div><div class="task-schedule"><i class="fas fa-clock me-1"></i> Executado a cada 6 horas </div></div><div class="task-actions"><button type="button" class="btn btn-outline-primary btn-sm" onclick="runTask('cache_cleanup')"><i class="fas fa-play"></i></button><button type="button" class="btn btn-outline-secondary btn-sm" onclick="configureTask('cache_cleanup')"><i class="fas fa-cog"></i></button></div></div><div class="backup-progress"><div class="backup-progress-fill w-100" data-progress-color="#10b981"></div></div><div class="text-muted small">Última execução: 30 min atrás</div></div><div class="maintenance-task"><div class="task-header"><div class="task-info"><div class="task-title">Compactação do Banco</div><div class="task-description">Otimiza e compacta o banco de dados para melhor performance</div><div class="task-schedule"><i class="fas fa-clock me-1"></i> Executado semanalmente </div></div><div class="task-actions"><button type="button" class="btn btn-outline-primary btn-sm" onclick="runTask('db_optimize')"><i class="fas fa-play"></i></button><button type="button" class="btn btn-outline-secondary btn-sm" onclick="configureTask('db_optimize')"><i class="fas fa-cog"></i></button></div></div><div class="backup-progress"><div class="backup-progress-fill w-45" data-progress-color="#3b82f6"></div></div><div class="text-muted small">Em execução... 45% concluído</div></div><div class="maintenance-task"><div class="task-header"><div class="task-info"><div class="task-title">Rotação de Logs</div><div class="task-description">Arquiva logs antigos e libera espaço em disco</div><div class="task-schedule"><i class="fas fa-clock me-1"></i> Executado diariamente </div></div><div class="task-actions"><button type="button" class="btn btn-outline-primary btn-sm" onclick="runTask('log_rotation')"><i class="fas fa-play"></i></button><button type="button" class="btn btn-outline-secondary btn-sm" onclick="configureTask('log_rotation')"><i class="fas fa-cog"></i></button></div></div><div class="backup-progress"><div class="backup-progress-fill w-100" data-progress-color="#10b981"></div></div><div class="text-muted small">Última execução: 2 horas atrás</div></div><div class="text-center mt-3"><button type="button" class="btn btn-primary" onclick="runAllTasks()"><i class="fas fa-bolt me-2"></i> Executar Todas as Tarefas </button></div></div></div><!-- Backup History --><div class="col-lg-6"><div class="filter-panel" data-aos="fade-up" data-aos-delay="300"><h5 class="fw-bold mb-3"><i class="fas fa-history me-2 text-primary"></i> Histórico de Backups </h5><div class="backup-timeline"><div class="backup-timeline-item"><div class="d-flex justify-content-between align-items-start mb-2"><div><h6 class="fw-bold mb-1">Backup Completo</h6><p class="text-muted mb-1">backup_20240120_140000.sql.gz</p><div class="d-flex align-items-center gap-2"><span class="badge bg-success">Sucesso</span><span class="text-muted small">2.4 GB</span></div></div><div class="text-end"><div class="text-muted small">2 horas atrás</div><div class="backup-actions mt-2"><button type="button" class="btn btn-outline-primary btn-sm" onclick="downloadBackup('backup_20240120_140000')"><i class="fas fa-download"></i></button><button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteBackup('backup_20240120_140000')"><i class="fas fa-trash"></i></button></div></div></div></div><div class="backup-timeline-item"><div class="d-flex justify-content-between align-items-start mb-2"><div><h6 class="fw-bold mb-1">Backup Incremental</h6><p class="text-muted mb-1">backup_inc_20240120_080000.sql.gz</p><div class="d-flex align-items-center gap-2"><span class="badge bg-success">Sucesso</span><span class="text-muted small">450 MB</span></div></div><div class="text-end"><div class="text-muted small">8 horas atrás</div><div class="backup-actions mt-2"><button type="button" class="btn btn-outline-primary btn-sm" onclick="downloadBackup('backup_inc_20240120_080000')"><i class="fas fa-download"></i></button><button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteBackup('backup_inc_20240120_080000')"><i class="fas fa-trash"></i></button></div></div></div></div><div class="backup-timeline-item"><div class="d-flex justify-content-between align-items-start mb-2"><div><h6 class="fw-bold mb-1">Backup Agendado</h6><p class="text-muted mb-1">backup_20240119_220000.sql.gz</p><div class="d-flex align-items-center gap-2"><span class="badge bg-danger">Falhou</span><span class="text-muted small">Erro: Espaço insuficiente</span></div></div><div class="text-end"><div class="text-muted small">1 dia atrás</div><div class="backup-actions mt-2"><button type="button" class="btn btn-outline-warning btn-sm" onclick="retryBackup('backup_20240119_220000')"><i class="fas fa-redo"></i></button><button type="button" class="btn btn-outline-info btn-sm" onclick="viewBackupLog('backup_20240119_220000')"><i class="fas fa-eye"></i></button></div></div></div></div></div><div class="text-center mt-3"><button type="button" class="btn btn-outline-primary" onclick="viewAllBackups()"><i class="fas fa-list me-2"></i> Ver Todos os Backups </button></div></div></div></div></div>
{% endblock %} {% block extra_js %}
{% endblock %} function startProgressUpdates() { setInterval(() => { updateMaintenanceProgress(); }, 5000); // Update every 5 seconds
} function updateMaintenanceProgress() { // Mock progress update - replace with actual implementation const progressBars = document.querySelectorAll('.maintenance-task .backup-progress-fill[style*="45%"]'); progressBars.forEach(bar => { const currentWidth = parseInt(bar.style.width); if (currentWidth < 100) { bar.style.width = (currentWidth + Math.random() * 10) + '%'; } });
} function runSystemCheck() { showNotification('Iniciando verificação completa do sistema...', 'info'); // Mock system check - replace with actual implementation setTimeout(() => { showNotification('Verificação concluída: Sistema operando normalmente', 'success'); }, 3000);
} function createBackup() { if (confirm('Iniciar backup manual do sistema agora?')) { showNotification('Iniciando backup manual...', 'info'); // Mock backup creation - replace with actual implementation setTimeout(() => { showNotification('Backup criado com sucesso!', 'success'); // Refresh page or update UI }, 5000); }
} function toggleMaintenanceMode() { const isActive = document.querySelector('.maintenance-mode-banner').classList.contains('active'); const action = isActive ? 'desativar' : 'ativar'; if (confirm(`Tem certeza que deseja ${action} o modo de manutenção?`)) { showNotification(`${action === 'ativar' ? 'Ativando' : 'Desativando'} modo de manutenção...`, 'warning'); // Mock toggle - replace with actual implementation setTimeout(() => { location.reload(); }, 2000); }
} function runTask(taskId) { showNotification(`Executando tarefa: ${taskId}`, 'info'); // Mock task execution - replace with actual implementation setTimeout(() => { showNotification('Tarefa executada com sucesso!', 'success'); updateTaskProgress(taskId); }, 2000);
} function configureTask(taskId) { showNotification(`Abrindo configurações para: ${taskId}`, 'info'); // Redirect to configuration page or open modal
} function runAllTasks() { if (confirm('Executar todas as tarefas de manutenção? Isso pode afetar a performance temporariamente.')) { showNotification('Executando todas as tarefas de manutenção...', 'warning'); // Mock execution - replace with actual implementation setTimeout(() => { showNotification('Todas as tarefas executadas com sucesso!', 'success'); }, 8000); }
} function updateTaskProgress(taskId) { // Mock progress update - replace with actual implementation const task = document.querySelector(`[onclick="runTask('${taskId}')"]`).closest('.maintenance-task'); const progressBar = task.querySelector('.backup-progress-fill'); progressBar.style.width = '100%'; progressBar.style.setProperty('--progress-color', '#10b981'); const statusText = task.querySelector('.text-muted.small'); statusText.textContent = 'Executado agora mesmo';
} function downloadBackup(backupId) { showNotification(`Preparando download do backup: ${backupId}`, 'info'); // Mock download - replace with actual implementation setTimeout(() => { showNotification('Download iniciado!', 'success'); // Trigger actual download const link = document.createElement('a'); link.href = `#download-${backupId}`; link.download = `${backupId}.sql.gz`; link.click(); }, 2000);
} function deleteBackup(backupId) { if (confirm(`Excluir permanentemente o backup ${backupId}? Esta ação não pode ser desfeita.`)) { showNotification('Excluindo backup...', 'warning'); // Mock deletion - replace with actual implementation setTimeout(() => { showNotification('Backup excluído com sucesso!', 'success'); // Remove from UI or refresh event.target.closest('.backup-timeline-item').remove(); }, 1500); }
} function retryBackup(backupId) { if (confirm(`Tentar novamente o backup ${backupId}?`)) { showNotification('Tentando novamente...', 'info'); // Mock retry - replace with actual implementation setTimeout(() => { showNotification('Backup executado com sucesso!', 'success'); location.reload(); }, 5000); }
} function viewBackupLog(backupId) { showNotification(`Abrindo log do backup: ${backupId}`, 'info'); // Open modal or redirect to log viewer
} function viewAllBackups() { showNotification('Carregando histórico completo...', 'info'); // Redirect to full backup history page window.location.href = '/core/backups/history/';
} function showNotification(message, type = 'info') { const notification = document.createElement('div'); notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`; notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;'; notification.innerHTML = ` ${message} <button type="button" class="btn-close" data-bs-dismiss="alert"></button> `; document.body.appendChild(notification); setTimeout(() => { if (notification.parentNode) { notification.remove(); } }, 5000);
}
</script>
{% endblock %}
