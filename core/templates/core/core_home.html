{% extends "pandora_home_ultra_modern.html" %}
{% load i18n %}
{% load humanize %}
{% load static %}

{% block title %}üè¢ M√≥dulo CORE - Pandora ERP{% endblock %}

{% block home_icon %}<i class="fas fa-cube me-2 text-primary"></i>{% endblock %}
{% block home_title %}M√≥dulo CORE{% endblock %}
{% block home_subtitle %}Central de gerenciamento de empresas, usu√°rios e configura√ß√µes do sistema{% endblock %}

{% block home_stats %}
    <div class="mb-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-chart-bar me-2 text-primary"></i>
            Vis√£o Geral do Sistema
        </h2>
        <div class="row g-4" data-aos="fade-up" data-aos-delay="100">
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:tenant_list' %}" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon bg-gradient-primary text-white mx-auto mb-3">
                                <i class="fas fa-building"></i>
                            </div>
                            <h3 class="display-6 fw-bold text-primary mb-1">{{ total_tenants|default:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">Total de Empresas</p>
                            <small class="text-muted">Cadastradas no sistema</small>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:tenant_list' %}?status=active" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon bg-gradient-success text-white mx-auto mb-3">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="display-6 fw-bold text-success mb-1">{{ active_tenants|default:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">Empresas Ativas</p>
                            <small class="text-muted">Em funcionamento</small>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:tenant_user_list' %}" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon bg-gradient-info text-white mx-auto mb-3">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 class="display-6 fw-bold text-info mb-1">{{ total_users|default:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">Total de Usu√°rios</p>
                            <small class="text-muted">Cadastrados</small>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:role_list' %}" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon bg-gradient-warning text-white mx-auto mb-3">
                                <i class="fas fa-user-tag"></i>
                            </div>
                            <h3 class="display-6 fw-bold text-warning mb-1">{{ total_roles|default:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">Cargos</p>
                            <small class="text-muted">Configurados</small>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:department_list' %}" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon text-white mx-auto mb-3" style="background: linear-gradient(135deg, #6f42c1 0%, #59359a 100%);">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <h3 class="display-6 fw-bold mb-1" style="color: #6f42c1;">{{ total_departamentos|default:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">Departamentos</p>
                            <small class="text-muted">Organizados</small>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'core:reports' %}" class="text-decoration-none">
                    <div class="action-card h-100">
                        <div class="card-body text-center p-4">
                            <div class="action-icon bg-gradient-danger text-white mx-auto mb-3">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <h3 class="display-6 fw-bold text-danger mb-1">R$ {{ mrr_value|default:0|floatformat:0 }}</h3>
                            <p class="text-muted mb-1 fw-semibold">MRR Estimado</p>
                            <small class="text-muted">Receita mensal</small>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
{% endblock %}

{% block home_actions %}
    <div class="mb-5">
        <style>
        .tenant-badge { display:block; overflow:hidden; padding:2px 6px; font-size:.65rem; line-height:1rem; white-space:nowrap; }
        .tenant-badge-inner { display:inline-block; animation: tenant-scroll 12s linear infinite; padding-right:40px; }
        @keyframes tenant-scroll { 0% { transform: translateX(0); } 40% { transform: translateX(0); } 50% { transform: translateX(calc(-100% + 200px)); } 90% { transform: translateX(calc(-100% + 200px)); } 100% { transform: translateX(0); } }
        @media (prefers-reduced-motion: reduce) { .tenant-badge-inner { animation:none; } }
        </style>
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-bolt me-2 text-primary"></i>
            A√ß√µes R√°pidas
        </h2>
        <div class="row g-4" data-aos="fade-up" data-aos-delay="200">
            <!-- Trocar Empresa / Selecionar Tenant -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="250">
                <div class="action-card h-100 position-relative">
                    <div class="card-body text-center p-4">
                                                                        <div class="action-icon bg-gradient-dark text-white mx-auto mb-2 d-flex align-items-center justify-content-center" style="height:60px;">
                                                                                <i class="fas fa-exchange-alt"></i>
                                                                        </div>
                                                                        {% if request.tenant %}
                                                                        <div class="mx-auto mb-2" style="max-width:200px; height:20px; position:relative;">
                                                                                <span class="badge bg-dark tenant-badge w-100" title="{{ request.tenant.name }}">
                                                                                        <span class="tenant-badge-inner">{{ request.tenant.name }}</span>
                                                                                </span>
                                                                        </div>
                                                                        {% endif %}
                        <h4 class="h5 fw-bold mb-3">Trocar Empresa</h4>
                        <p class="text-muted mb-4">Selecione outro tenant para contextualizar a sess√£o</p>
                        <div class="d-flex gap-2 justify-content-center flex-wrap">
                            <a href="{% url 'core:tenant_select' %}" class="btn btn-dark btn-sm" style="min-width:140px;">
                                <i class="fas fa-random me-1"></i>Selecionar
                            </a>
                            <a href="{% url 'core:tenant_list' %}" class="btn btn-outline-dark btn-sm" style="min-width:140px;">
                                <i class="fas fa-building me-1"></i>Empresas
                            </a>
                        </div>
                                                                        {% if not request.tenant %}
                                                                            <div class="mt-2 small text-muted">Nenhuma empresa selecionada</div>
                                                                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- Gest√£o de Empresas -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="300">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-primary text-white mx-auto mb-3">
                            <i class="fas fa-building"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Gest√£o de Empresas</h4>
                        <p class="text-muted mb-4">Crie e gerencie empresas cadastradas no sistema</p>
                        <div class="d-flex gap-2 justify-content-center">
                                <a href="{% url 'core:tenant_create' %}" class="btn btn-primary btn-sm" style="min-width: 110px;">
                                <i class="fas fa-plus me-1"></i>Criar
                            </a>
                            <a href="{% url 'core:tenant_list' %}" class="btn btn-outline-primary btn-sm" style="min-width: 110px;">
                                <i class="fas fa-list me-1"></i>Listar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gest√£o de Usu√°rios -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="400">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-success text-white mx-auto mb-3">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Gest√£o de Usu√°rios</h4>
                        <p class="text-muted mb-4">Crie e gerencie usu√°rios do sistema</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="{% url 'core:tenant_user_create' %}" class="btn btn-success btn-sm" style="min-width: 110px;">
                                <i class="fas fa-user-plus me-1"></i>Criar
                            </a>
                            <a href="{% url 'core:tenant_user_list' %}" class="btn btn-outline-success btn-sm" style="min-width: 110px;">
                                <i class="fas fa-users-cog me-1"></i>Gerenciar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gest√£o de Cargos -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="500">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-warning text-white mx-auto mb-3">
                            <i class="fas fa-user-tag"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Cargos e Fun√ß√µes</h4>
                        <p class="text-muted mb-4">Configure cargos e fun√ß√µes organizacionais</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="{% url 'core:role_create' %}" class="btn btn-warning btn-sm" style="min-width: 110px;">
                                <i class="fas fa-plus me-1"></i>Criar
                            </a>
                            <a href="{% url 'core:role_list' %}" class="btn btn-outline-warning btn-sm" style="min-width: 110px;">
                                <i class="fas fa-tags me-1"></i>Listar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Departamentos -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="600">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-info text-white mx-auto mb-3">
                            <i class="fas fa-sitemap"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Departamentos</h4>
                        <p class="text-muted mb-4">Organize a estrutura departamental das empresas</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="{% url 'core:department_create' %}" class="btn btn-info btn-sm" style="min-width: 110px;">
                                <i class="fas fa-plus me-1"></i>Criar
                            </a>
                            <a href="{% url 'core:department_list' %}" class="btn btn-outline-info btn-sm" style="min-width: 110px;">
                                <i class="fas fa-sitemap me-1"></i>Listar
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios do Sistema -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="700">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-secondary text-white mx-auto mb-3">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Relat√≥rios do Sistema</h4>
                        <p class="text-muted mb-4">Visualize relat√≥rios e m√©tricas do sistema</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="{% url 'core:reports' %}" class="btn btn-secondary btn-sm" style="min-width: 110px;">
                                <i class="fas fa-chart-bar me-1"></i>Relat√≥rios
                            </a>
                            <button class="btn btn-outline-secondary btn-sm" style="min-width: 110px;" onclick="alert('Export em desenvolvimento')">
                                <i class="fas fa-download me-1"></i>Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes Globais -->
            <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="800">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-danger text-white mx-auto mb-3">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <h4 class="h5 fw-bold mb-3">Configura√ß√µes Globais</h4>
                        <p class="text-muted mb-4">Configure par√¢metros globais do sistema</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a href="{% url 'core:global_configurations' %}" class="btn btn-danger btn-sm" style="min-width: 110px;">
                                <i class="fas fa-globe me-1"></i>Globais
                            </a>
                            <button class="btn btn-outline-danger btn-sm" style="min-width: 110px;" onclick="alert('Configura√ß√µes avan√ßadas em breve')">
                                <i class="fas fa-tools me-1"></i>Avan√ßadas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block home_recent %}
    {% if recent_tenants %}
    <div class="mt-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-history me-2 text-primary"></i>
            Empresas Adicionadas Recentemente
        </h2>
        <div class="row g-4">
            <div class="col-12" data-aos="fade-up" data-aos-delay="100">
                <div class="action-card border-0 shadow-sm">
                    <div class="card-body p-0">
                        {% for tenant in recent_tenants %}
                        <div class="recent-item">
                            <div class="row align-items-center py-2">
                                <div class="col-auto">
                                    <div class="d-flex align-items-center justify-content-center bg-gradient-primary text-white rounded-circle" style="width: 52px; height: 52px;">
                                        {% if tenant.tipo_pessoa == 'PJ' %}
                                        <i class="fas fa-building fa-lg"></i>
                                        {% else %}
                                        <i class="fas fa-user fa-lg"></i>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col">
                                    <h6 class="mb-1 fw-bold">
                                        <a href="{% url 'core:tenant_detail' tenant.pk %}" class="text-decoration-none text-dark">
                                            {% if tenant.tipo_pessoa == 'PJ' and tenant.pessoajuridica_info %}
                                                {{ tenant.pessoajuridica_info.nome_fantasia|default:tenant.pessoajuridica_info.razao_social }}
                                            {% elif tenant.tipo_pessoa == 'PF' and tenant.pessoafisica_info %}
                                                {{ tenant.pessoafisica_info.nome_completo }}
                                            {% else %}
                                                {{ tenant.name }}
                                            {% endif %}
                                        </a>
                                    </h6>
                                    <div class="d-flex align-items-center gap-3">
                                        <small class="text-muted d-flex align-items-center">
                                            <i class="fas fa-id-card me-1"></i>
                                            {% if tenant.tipo_pessoa == 'PJ' and tenant.pessoajuridica_info %}
                                                {{ tenant.pessoajuridica_info.cnpj|default:"N√£o informado" }}
                                            {% elif tenant.tipo_pessoa == 'PF' and tenant.pessoafisica_info %}
                                                {{ tenant.pessoafisica_info.cpf|default:"N√£o informado" }}
                                            {% else %}
                                                {{ tenant.get_tipo_pessoa_display }}
                                            {% endif %}
                                        </small>
                                        <small class="text-muted d-flex align-items-center">
                                            <i class="fas fa-clock me-1"></i>
                                            {{ tenant.created_at|timesince }} atr√°s
                                        </small>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge-modern">
                                            <i class="fas fa-{% if tenant.status == 'active' %}check-circle{% elif tenant.status == 'inactive' %}times-circle{% else %}exclamation-circle{% endif %} me-1"></i>
                                            {{ tenant.get_status_display }}
                                        </span>
                                        <span class="badge-modern bg-light text-dark border">
                                            <i class="fas fa-{% if tenant.tipo_pessoa == 'PJ' %}building{% else %}user{% endif %} me-1"></i>
                                            {{ tenant.get_tipo_pessoa_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-5">
                            <div class="text-muted">
                                <i class="fas fa-building fa-3x mb-3 opacity-25"></i>
                                <h5 class="mb-2">Nenhuma empresa cadastrada ainda</h5>
                                <p class="mb-3">Clique em "Nova Empresa" para come√ßar</p>
                                    <a href="{% url 'core:tenant_create' %}" class="btn btn-primary">
                                    <i class="fas fa-plus me-2"></i>Criar Primeira Empresa
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% if recent_tenants %}
                    <div class="card-footer bg-light border-0 py-3 text-center">
                        <a href="{% url 'core:tenant_list' %}" class="btn btn-outline-primary">
                            <i class="fas fa-list me-2"></i>Ver Todas as Empresas
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="mt-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-history me-2 text-primary"></i>
            Empresas Recentes
        </h2>
        <div class="row g-4">
            <div class="col-12 text-center py-4" data-aos="fade-up">
                <div class="text-muted">
                    <i class="fas fa-building fa-3x mb-3 opacity-25"></i>
                    <h5 class="mb-2">Nenhuma empresa cadastrada ainda</h5>
                    <p class="mb-3">Clique em "Nova Empresa" para come√ßar</p>
                        <a href="{% url 'core:tenant_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>Criar Primeira Empresa
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endblock %}
