{% load i18n widget_tweaks %}

<div class="alert alert-info">
    <i class="icon fas fa-info"></i>
    {% trans "Associe múltiplos fornecedores a este serviço, cada um com seu próprio preço e regra de cobrança. Esta aba só é relevante para 'Serviços Contratados'." %}
</div>

{% if fornecedores_formset.non_form_errors %}
    <div class="alert alert-danger">
        {{ fornecedores_formset.non_form_errors }}
    </div>
{% endif %}

<div id="fornecedores-list">
    {{ fornecedores_formset.management_form }}
    {% for form in fornecedores_formset %}
        <div class="border rounded p-3 mb-3 position-relative" id="fornecedor-row-{{ forloop.counter0 }}">
            {% for hidden_field in form.hidden_fields %}{{ hidden_field }}{% endfor %}
            {% if form.instance.pk %}
                <button type="button" class="btn btn-sm btn-danger remove-form-row position-absolute" style="top:10px; right:10px;"><i class="fas fa-times"></i></button>
                <div class="d-none">{{ form.DELETE }}</div>
            {% endif %}

            <div class="row g-3">
                <div class="col-md-3">
                    <label for="{{ form.fornecedor.id_for_label }}" class="form-label">{{ form.fornecedor.label }}</label>
                    {% render_field form.fornecedor class="form-control" %}
                    {% for error in form.fornecedor.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
                <div class="col-md-3">
                    <label for="{{ form.preco_base_fornecedor.id_for_label }}" class="form-label">{{ form.preco_base_fornecedor.label }}</label>
                    <div class="input-group">
                        <span class="input-group-text">R$</span>
                        {% render_field form.preco_base_fornecedor class="form-control" %}
                    </div>
                    {% for error in form.preco_base_fornecedor.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
                <div class="col-md-3">
                    <label for="{{ form.regra_cobranca_fornecedor.id_for_label }}" class="form-label">{{ form.regra_cobranca_fornecedor.label }}</label>
                    {% render_field form.regra_cobranca_fornecedor class="form-control" %}
                    {% for error in form.regra_cobranca_fornecedor.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
                <div class="col-md-3">
                    <label for="{{ form.codigo_fornecedor.id_for_label }}" class="form-label">{{ form.codigo_fornecedor.label }}</label>
                    {% render_field form.codigo_fornecedor class="form-control" %}
                    {% for error in form.codigo_fornecedor.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>
<button type="button" id="add-fornecedor-row" class="btn btn-sm btn-success mt-2"><i class="fas fa-plus me-1"></i> {% trans "Adicionar Fornecedor" %}</button>
