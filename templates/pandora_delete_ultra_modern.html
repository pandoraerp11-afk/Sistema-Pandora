{% extends "pandora_ultra_modern_base.html" %}
{% load static %}

{% block title %}{% block delete_title %}Confirmar Exclusão{% endblock %} - {{ block.super }}{% endblock %}

{% block page_title %}
    <i class="fas fa-exclamation-triangle me-2 text-danger"></i>
    {% block delete_title_content %}Confirmar Exclusão{% endblock %}
{% endblock %}

{% block page_subtitle %}
    {% block delete_subtitle %}Esta ação não pode ser desfeita{% endblock %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0 fw-bold">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Atenção: Exclusão Permanente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
                        <i class="fas fa-exclamation-triangle me-3 fs-4"></i>
                        <div>
                            {% block confirmation_message %}
                            <strong>Tem certeza que deseja excluir este item?</strong><br>
                            Esta ação não pode ser desfeita e todos os dados relacionados serão perdidos permanentemente.
                            {% endblock %}
                        </div>
                    </div>

                        {% block object_info %}
                        <div class="bg-light p-4 rounded mb-4">
                            <h6 class="text-muted mb-3 fw-bold">Item que será excluído:</h6>
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    {% block object_icon %}
                                    <i class="fas fa-file-alt fs-1 text-muted"></i>
                                    {% endblock %}
                                </div>
                                <div>
                                    <h5 class="mb-1 fw-bold">{% block object_title %}{{ object }}{% endblock %}</h5>
                                    <p class="text-muted mb-0">
                                        {% block object_description %}
                                        {% if object.description %}{{ object.description }}{% endif %}
                                        {% if object.created_at %}Criado em {{ object.created_at|date:"d/m/Y" }}{% endif %}
                                        {% endblock %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endblock %}

                        {% block impact_warning %}
                        <div class="mb-4">
                            <h6 class="text-danger mb-3 fw-bold">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                O que será afetado:
                            </h6>
                            <ul class="list-unstyled">
                                {% block impact_list %}
                                <li class="d-flex align-items-center mb-2">
                                    <i class="fas fa-times-circle text-danger me-2"></i>
                                    <span>Todos os dados relacionados a este item</span>
                                </li>
                                <li class="d-flex align-items-center mb-2">
                                    <i class="fas fa-times-circle text-danger me-2"></i>
                                    <span>Histórico e logs de atividades</span>
                                </li>
                                <li class="d-flex align-items-center mb-2">
                                    <i class="fas fa-times-circle text-danger me-2"></i>
                                    <span>Relacionamentos com outros registros</span>
                                </li>
                                {% endblock %}
                            </ul>
                        </div>
                        {% endblock %}

                        <form method="post" id="deleteForm">
                            {% csrf_token %}
                            
                            {% block additional_fields %}
                            {% endblock %}

                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                                <label class="form-check-label fw-bold" for="confirmDelete">
                                    {% block confirmation_text %}
                                    Eu entendo que esta ação é irreversível e confirmo a exclusão
                                    {% endblock %}
                                </label>
                            </div>

                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <button type="button" onclick="history.back()" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i>
                                        Cancelar
                                    </button>
                                </div>
                                <div>
                                    <button type="submit" class="btn btn-danger" id="deleteButton" disabled>
                                        <i class="fas fa-trash me-1"></i>
                                        {% block delete_button_text %}Excluir Permanentemente{% endblock %}
                                    </button>
                                </div>
                            </div>
                        </form>
                </div>
            </div>

            {% block additional_info %}
            <div class="card mt-4">
                <div class="card-body">
                    <h6 class="text-muted mb-3 fw-bold">
                        <i class="fas fa-info-circle me-2"></i>
                        Alternativas à exclusão:
                    </h6>
                    <ul class="list-unstyled">
                        <li class="d-flex align-items-center mb-2">
                            <i class="fas fa-archive text-primary me-2"></i>
                            <span>Arquivar o item (manter dados, mas ocultar)</span>
                        </li>
                        <li class="d-flex align-items-center mb-2">
                            <i class="fas fa-eye-slash text-secondary me-2"></i>
                            <span>Desativar temporariamente</span>
                        </li>
                        <li class="d-flex align-items-center mb-2">
                            <i class="fas fa-pencil-alt text-success me-2"></i>
                            <span>Editar as informações necessárias</span>
                        </li>
                    </ul>
                </div>
            </div>
            {% endblock %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteButton = document.getElementById('deleteButton');
    const deleteForm = document.getElementById('deleteForm');

    // Enable/disable delete button based on checkbox
    confirmCheckbox.addEventListener('change', function() {
        deleteButton.disabled = !this.checked;
        
        if (this.checked) {
            deleteButton.classList.remove('btn-secondary');
            deleteButton.classList.add('btn-danger');
        } else {
            deleteButton.classList.remove('btn-danger');
            deleteButton.classList.add('btn-secondary');
        }
    });

    // Double confirmation on form submit
    deleteForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Usando SweetAlert2 padrão do sistema
        Swal.fire({
            title: 'Você tem certeza?',
            text: 'Esta ação é a última confirmação e não pode ser desfeita.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#dc3545',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sim, excluir para sempre!',
            cancelButtonText: 'Cancelar',
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                // Show loading state
                deleteButton.disabled = true;
                deleteButton.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Excluindo...';
                
                // Submit form
                this.submit();
            }
        });
    });

    // Auto-focus on cancel button for safety
    setTimeout(() => {
        const cancelButton = document.querySelector('button[onclick="history.back()"]');
        if (cancelButton) {
            cancelButton.focus();
        }
    }, 100);
});
</script>
{% endblock %}
