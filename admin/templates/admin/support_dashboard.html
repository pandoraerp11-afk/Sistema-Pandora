{% extends "pandora_home_ultra_modern.html" %}
{% load i18n %}
{% load humanize %}
{% load static %}

{% block title %}üéß Suporte e Ajuda - Pandora ERP{% endblock %}

{% block home_icon %}<i class="fas fa-headset me-2 text-primary"></i>{% endblock %}
{% block home_title %}Suporte e Ajuda{% endblock %}
{% block home_subtitle %}Central de atendimento e recursos de ajuda{% endblock %}

{% block home_stats %}
    <div class="mb-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-chart-line me-2 text-primary"></i>
            Status do Suporte
        </h2>
        <div class="row g-4" data-aos="fade-up" data-aos-delay="100">
            <!-- Tickets Abertos -->
            <div class="col-lg-3 col-md-6">
                <div class="support-card primary h-100">
                    <div class="card-body p-4 text-center">
                        <div class="support-icon bg-primary text-white mx-auto">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-primary mb-1">{{ open_tickets }}</h3>
                        <p class="text-muted mb-1 fw-semibold">{% trans "Tickets Abertos" %}</p>
                        <small class="text-muted">Aguardando resposta</small>
                    </div>
                </div>
            </div>
            
            <!-- Tempo M√©dio -->
            <div class="col-lg-3 col-md-6">
                <div class="support-card success h-100">
                    <div class="card-body p-4 text-center">
                        <div class="support-icon bg-success text-white mx-auto">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-success mb-1">{{ avg_response_time }}h</h3>
                        <p class="text-muted mb-1 fw-semibold">{% trans "Tempo de Resposta" %}</p>
                        <small class="text-muted">M√©dia dos √∫ltimos 30 dias</small>
                    </div>
                </div>
            </div>
            
            <!-- Satisfa√ß√£o -->
            <div class="col-lg-3 col-md-6">
                <div class="support-card warning h-100">
                    <div class="card-body p-4 text-center">
                        <div class="support-icon bg-warning text-white mx-auto">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-warning mb-1">{{ satisfaction_rate|floatformat:1 }}%</h3>
                        <p class="text-muted mb-1 fw-semibold">{% trans "Satisfa√ß√£o" %}</p>
                        <small class="text-muted">Avalia√ß√£o dos clientes</small>
                    </div>
                </div>
            </div>
            
            <!-- Status Sistema -->
            <div class="col-lg-3 col-md-6">
                <div class="support-card info h-100">
                    <div class="card-body p-4 text-center">
                        <div class="support-icon bg-{{ system_status.color }} text-white mx-auto">
                            <i class="{{ system_status.icon }}"></i>
                        </div>
                        <h5 class="fw-bold text-{{ system_status.color }} mb-1">{{ system_status.text }}</h5>
                        <p class="text-muted mb-1 fw-semibold">{% trans "Sistema" %}</p>
                        <small class="text-muted">{{ system_status.description }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block home_actions %}
    <!-- Novo Ticket -->
    <div class="mb-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-plus-circle me-2 text-primary"></i>
            {% trans "Abrir Novo Ticket" %}
        </h2>
        <div class="row" data-aos="fade-up" data-aos-delay="200">
            <div class="col-lg-8 mx-auto">
                <div class="new-ticket-card">
                    <div class="card-body p-4">
                        <form id="newTicketForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="ticketCategory" required>
                                            <option value="">Selecione uma categoria</option>
                                            <option value="technical">Problema T√©cnico</option>
                                            <option value="billing">Quest√£o Financeira</option>
                                            <option value="feature">Solicita√ß√£o de Recurso</option>
                                            <option value="training">Treinamento</option>
                                            <option value="other">Outros</option>
                                        </select>
                                        <label for="ticketCategory">Categoria</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="ticketPriority" required>
                                            <option value="">Selecione a prioridade</option>
                                            <option value="low">Baixa</option>
                                            <option value="medium" selected>M√©dia</option>
                                            <option value="high">Alta</option>
                                            <option value="urgent">Urgente</option>
                                        </select>
                                        <label for="ticketPriority">Prioridade</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="ticketSubject" placeholder="Assunto" required>
                                        <label for="ticketSubject">Assunto</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="ticketDescription" placeholder="Descri√ß√£o" style="height: 120px" required></textarea>
                                        <label for="ticketDescription">Descri√ß√£o detalhada do problema</label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label">Anexos (opcional)</label>
                                        <input type="file" class="form-control" id="ticketAttachments" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                                        <div class="form-text">Formatos aceitos: JPG, PNG, PDF, DOC, DOCX (m√°x. 5MB cada)</div>
                                    </div>
                                </div>
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary btn-lg px-5">
                                        <i class="fas fa-paper-plane me-2"></i>
                                        Abrir Ticket
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Meus Tickets -->
    <div class="mb-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-list me-2 text-primary"></i>
            {% trans "Meus Tickets" %}
        </h2>
        <div class="tickets-list-card" data-aos="fade-up" data-aos-delay="100">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">{% trans "Ticket" %}</th>
                                <th>{% trans "Categoria" %}</th>
                                <th>{% trans "Status" %}</th>
                                <th>{% trans "Prioridade" %}</th>
                                <th>{% trans "Criado" %}</th>
                                <th class="pe-4">{% trans "A√ß√µes" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ticket in my_tickets %}
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="ticket-icon bg-light text-primary me-3">
                                            <i class="fas fa-ticket-alt"></i>
                                        </div>
                                        <div>
                                            <div class="fw-semibold">#{{ ticket.number }}</div>
                                            <div class="text-truncate" style="max-width: 250px;">{{ ticket.subject }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-{{ ticket.category.color }}">
                                        <i class="{{ ticket.category.icon }} me-1"></i>
                                        {{ ticket.category.name }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-{{ ticket.status.color }}">
                                        <i class="{{ ticket.status.icon }} me-1"></i>
                                        {{ ticket.status.text }}
                                    </span>
                                </td>
                                <td>
                                    <span class="priority-badge priority-{{ ticket.priority }}">
                                        {{ ticket.priority_display }}
                                    </span>
                                </td>
                                <td>
                                    <div>{{ ticket.created_at }}</div>
                                    <small class="text-muted">{{ ticket.created_by }}</small>
                                </td>
                                <td class="pe-4">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="viewTicket('{{ ticket.id }}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        {% if ticket.can_respond %}
                                        <button class="btn btn-outline-success" onclick="respondTicket('{{ ticket.id }}')">
                                            <i class="fas fa-reply"></i>
                                        </button>
                                        {% endif %}
                                        {% if ticket.can_close %}
                                        <button class="btn btn-outline-danger" onclick="closeTicket('{{ ticket.id }}')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block home_recent %}
    <div class="row g-4 mb-5">
        <!-- Base de Conhecimento -->
        <div class="col-lg-8" data-aos="fade-up">
            <div class="knowledge-base-card">
                <div class="card-header bg-transparent border-0 p-4 pb-2">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-book me-2 text-info"></i>
                        {% trans "Base de Conhecimento" %}
                    </h5>
                </div>
                <div class="card-body p-4 pt-2">
                    <div class="knowledge-search mb-4">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="knowledgeSearch" placeholder="Pesquisar na base de conhecimento...">
                            <label for="knowledgeSearch">Pesquisar artigos...</label>
                        </div>
                    </div>
                    
                    <div class="knowledge-categories">
                        <div class="row g-3">
                            {% for category in knowledge_categories %}
                            <div class="col-md-6">
                                <div class="knowledge-category-card">
                                    <div class="d-flex align-items-center p-3">
                                        <div class="knowledge-category-icon bg-{{ category.color }} text-white me-3">
                                            <i class="{{ category.icon }}"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1">{{ category.name }}</h6>
                                            <small class="text-muted">{{ category.articles_count }} artigos</small>
                                        </div>
                                        <i class="fas fa-chevron-right text-muted"></i>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contatos de Suporte -->
        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">
            <div class="support-contacts-card h-100">
                <div class="card-header bg-transparent border-0 p-4 pb-2">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-phone me-2 text-success"></i>
                        {% trans "Contatos de Suporte" %}
                    </h5>
                </div>
                <div class="card-body p-4 pt-2">
                    <div class="support-contacts-list">
                        {% for contact in support_contacts %}
                        <div class="support-contact-item d-flex align-items-center mb-3 p-3 border rounded">
                            <div class="support-contact-icon bg-{{ contact.color }} text-white me-3">
                                <i class="{{ contact.icon }}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-semibold">{{ contact.name }}</div>
                                <small class="text-muted">{{ contact.description }}</small>
                                <div class="contact-info mt-1">
                                    <small class="text-primary">{{ contact.info }}</small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="support-schedule mt-4 p-3 bg-light rounded">
                        <h6 class="mb-2">
                            <i class="fas fa-calendar-alt me-2 text-primary"></i>
                            Hor√°rio de Atendimento
                        </h6>
                        <div class="schedule-info">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Segunda a Sexta:</small>
                                <small class="fw-semibold">8h √†s 18h</small>
                            </div>
                            <div class="d-flex justify-content-between mb-1">
                                <small>S√°bado:</small>
                                <small class="fw-semibold">8h √†s 12h</small>
                            </div>
                            <div class="d-flex justify-content-between">
                                <small>Domingo:</small>
                                <small class="text-muted">Fechado</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- A√ß√µes R√°pidas -->
    <div class="mb-5">
        <h2 class="section-title" data-aos="fade-up">
            <i class="fas fa-rocket me-2 text-primary"></i>
            {% trans "A√ß√µes R√°pidas" %}
        </h2>
        <div class="row g-4" data-aos="fade-up" data-aos-delay="100">
            <div class="col-md-3">
                <div class="quick-action-card text-center p-4">
                    <div class="quick-action-icon bg-gradient-primary text-white mx-auto mb-3">
                        <i class="fas fa-video"></i>
                    </div>
                    <h6 class="mb-2">{% trans "Treinamento Online" %}</h6>
                    <p class="text-muted mb-3 small">Acesse nossos tutoriais</p>
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-play me-1"></i>
                        Assistir
                    </button>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="quick-action-card text-center p-4">
                    <div class="quick-action-icon bg-gradient-success text-white mx-auto mb-3">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h6 class="mb-2">{% trans "Agendar Atendimento" %}</h6>
                    <p class="text-muted mb-3 small">Marque uma reuni√£o conosco</p>
                    <button class="btn btn-outline-success btn-sm">
                        <i class="fas fa-calendar-plus me-1"></i>
                        Agendar
                    </button>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="quick-action-card text-center p-4">
                    <div class="quick-action-icon bg-gradient-info text-white mx-auto mb-3">
                        <i class="fas fa-download"></i>
                    </div>
                    <h6 class="mb-2">{% trans "Downloads" %}</h6>
                    <p class="text-muted mb-3 small">Manuais e documenta√ß√£o</p>
                    <button class="btn btn-outline-info btn-sm">
                        <i class="fas fa-folder-open me-1"></i>
                        Baixar
                    </button>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="quick-action-card text-center p-4">
                    <div class="quick-action-icon bg-gradient-warning text-white mx-auto mb-3">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h6 class="mb-2">{% trans "Chat Online" %}</h6>
                    <p class="text-muted mb-3 small">Fale conosco em tempo real</p>
                    <button class="btn btn-outline-warning btn-sm" onclick="openChat()">
                        <i class="fas fa-comment-dots me-1"></i>
                        Iniciar Chat
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_css %}
<style>
.support-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    border: 1px solid #e9ecef;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

.support-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
}

.support-icon {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    margin-bottom: 16px;
}

.new-ticket-card, .tickets-list-card, .knowledge-base-card, .support-contacts-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    border: 1px solid #e9ecef;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.new-ticket-card:hover, .tickets-list-card:hover, .knowledge-base-card:hover, .support-contacts-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}

.ticket-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.knowledge-category-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    border: 1px solid #e9ecef;
    border-radius: 12px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.knowledge-category-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.knowledge-category-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.support-contact-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.priority-badge {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
}

.priority-low {
    background-color: #d1ecf1;
    color: #0c5460;
}

.priority-medium {
    background-color: #fff3cd;
    color: #856404;
}

.priority-high {
    background-color: #f8d7da;
    color: #721c24;
}

.priority-urgent {
    background-color: #f5c6cb;
    color: #491217;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.quick-action-card {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    border: 1px solid #e9ecef;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.quick-action-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}

.quick-action-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.section-title {
    font-weight: 700;
    color: #212529;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
}

.bg-gradient-success {
    background: linear-gradient(135deg, #198754 0%, #146c43 100%);
}

.bg-gradient-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #0dcaf0 0%, #0aa2c0 100%);
}

.bg-gradient-danger {
    background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Formul√°rio de novo ticket
document.getElementById('newTicketForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = {
        category: document.getElementById('ticketCategory').value,
        priority: document.getElementById('ticketPriority').value,
        subject: document.getElementById('ticketSubject').value,
        description: document.getElementById('ticketDescription').value
    };
    
    if (!formData.category || !formData.priority || !formData.subject || !formData.description) {
        alert('Por favor, preencha todos os campos obrigat√≥rios.');
        return;
    }
    
    // Aqui faria a requisi√ß√£o AJAX para criar o ticket
    alert('Ticket criado com sucesso! Voc√™ receber√° uma confirma√ß√£o por email.');
    this.reset();
});

function viewTicket(ticketId) {
    alert('Visualizando ticket: ' + ticketId);
    // Aqui abriria modal ou nova p√°gina com detalhes do ticket
}

function respondTicket(ticketId) {
    alert('Respondendo ticket: ' + ticketId);
    // Aqui abriria modal para responder o ticket
}

function closeTicket(ticketId) {
    if (confirm('Deseja realmente fechar este ticket?')) {
        alert('Ticket fechado com sucesso!');
        // Aqui faria a requisi√ß√£o para fechar o ticket
        location.reload();
    }
}

function openChat() {
    alert('Abrindo chat online...');
    // Aqui abriria o widget de chat
}

// Pesquisa na base de conhecimento
document.getElementById('knowledgeSearch').addEventListener('input', function() {
    const query = this.value;
    if (query.length > 2) {
        // Aqui faria a pesquisa na base de conhecimento
        console.log('Pesquisando por:', query);
    }
});

// Clique nas categorias da base de conhecimento
document.querySelectorAll('.knowledge-category-card').forEach(card => {
    card.addEventListener('click', function() {
        const categoryName = this.querySelector('h6').textContent;
        alert('Abrindo categoria: ' + categoryName);
        // Aqui redirecionaria para a categoria espec√≠fica
    });
});
</script>
{% endblock %}
