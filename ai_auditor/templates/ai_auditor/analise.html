{% extends "pandora_ultra_modern_base.html" %}
{% load static %}

{% block title %}An치lise de C칩digo - Agente de IA{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'ai_auditor:dashboard' %}">Agente de IA</a></li>
        <li class="breadcrumb-item active">An치lise de C칩digo</li>
    </ol>
</nav>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    .analysis-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 32px;
        color: white;
        margin-bottom: 32px;
    }
    
    .analysis-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 8px;
    }
    
    .analysis-subtitle {
        opacity: 0.9;
        font-size: 1.1rem;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
    }
    
    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        border: 1px solid #e5e7eb;
        text-align: center;
        position: relative;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        border-radius: 16px 16px 0 0;
    }
    
    .stat-card.critical::before { background: #dc2626; }
    .stat-card.high::before { background: #ea580c; }
    .stat-card.medium::before { background: #d97706; }
    .stat-card.low::before { background: #65a30d; }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 8px;
    }
    
    .stat-label {
        color: #6b7280;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.875rem;
    }
    
    .issue-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 16px;
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .issue-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    
    .issue-severity {
        position: absolute;
        top: 0;
        left: 0;
        width: 6px;
        height: 100%;
        border-radius: 16px 0 0 16px;
    }
    
    .severity-critical { background: #dc2626; }
    .severity-high { background: #ea580c; }
    .severity-medium { background: #d97706; }
    .severity-low { background: #65a30d; }
    
    .issue-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
        padding-left: 16px;
    }
    
    .issue-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 8px;
    }
    
    .issue-meta {
        display: flex;
        gap: 16px;
        color: #6b7280;
        font-size: 0.875rem;
    }
    
    .badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .badge-critical { background: #dc2626; color: white; }
    .badge-high { background: #ea580c; color: white; }
    .badge-medium { background: #d97706; color: white; }
    .badge-low { background: #65a30d; color: white; }
    
    .badge-security { background: #fef2f2; color: #dc2626; }
    .badge-performance { background: #fef3c7; color: #d97706; }
    .badge-quality { background: #f0f9ff; color: #0284c7; }
    
    .issue-description {
        color: #4b5563;
        line-height: 1.6;
        margin-bottom: 16px;
        padding-left: 16px;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
        background: white;
        border-radius: 16px;
        border: 1px solid #e5e7eb;
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 16px;
        color: #d1d5db;
    }
    
    .action-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
    }
    
    .btn-ai {
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }
    
    .btn-ai-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-ai-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        color: white;
    }
    
    .btn-ai-secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }
    
    .btn-ai-secondary:hover {
        background: #667eea;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="analysis-header">
    <div class="analysis-title">游댌 An치lise de C칩digo</div>
    <div class="analysis-subtitle">Problemas identificados pela an치lise automatizada de c칩digo</div>
</div>

<!-- Bot칫es de A칞칚o -->
<div class="action-buttons">
    <a href="{% url 'ai_auditor:execute_audit' %}" class="btn-ai btn-ai-primary">
        <i class="ph-duotone ph-play"></i>
        Nova Auditoria
    </a>
    <a href="{% url 'ai_auditor:session_list' %}" class="btn-ai btn-ai-secondary">
        <i class="ph-duotone ph-clock-user"></i>
        Hist칩rico
    </a>
    <a href="{% url 'ai_auditor:chat' %}" class="btn-ai btn-ai-secondary">
        <i class="ph-duotone ph-chat-circle"></i>
        Chat IA
    </a>
</div>

<!-- Estat칤sticas -->
<div class="stats-grid">
    <div class="stat-card critical">
        <div class="stat-value">{{ critical_count|default:0 }}</div>
        <div class="stat-label">Cr칤ticos</div>
    </div>
    <div class="stat-card high">
        <div class="stat-value">{{ high_count|default:0 }}</div>
        <div class="stat-label">Alta Prioridade</div>
    </div>
    <div class="stat-card medium">
        <div class="stat-value">{{ medium_count|default:0 }}</div>
        <div class="stat-label">M칠dia Prioridade</div>
    </div>
    <div class="stat-card low">
        <div class="stat-value">{{ low_count|default:0 }}</div>
        <div class="stat-label">Baixa Prioridade</div>
    </div>
</div>

<!-- Lista de Problemas -->
{% if object_list %}
    {% for issue in object_list %}
    <div class="issue-card">
        <div class="issue-severity severity-{{ issue.severity }}"></div>
        
        <div class="issue-header">
            <div>
                <div class="issue-title">{{ issue.title }}</div>
                <div class="issue-meta">
                    <span><i class="ph-duotone ph-file"></i> {{ issue.file_path }}</span>
                    <span><i class="ph-duotone ph-hash"></i> Linha {{ issue.line_number }}</span>
                    {% if issue.auto_fixable %}
                        <span><i class="ph-duotone ph-wrench"></i> Corrig칤vel automaticamente</span>
                    {% endif %}
                </div>
            </div>
            <div>
                <span class="badge badge-{{ issue.severity }}">{{ issue.get_severity_display }}</span>
                <span class="badge badge-{{ issue.issue_type }}">{{ issue.get_issue_type_display }}</span>
            </div>
        </div>
        
        <div class="issue-description">
            {{ issue.description }}
        </div>
        
        {% if issue.recommendation %}
        <div class="issue-recommendation">
            <h6><i class="ph-duotone ph-lightbulb"></i> Recomenda칞칚o</h6>
            <p>{{ issue.recommendation }}</p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <div class="empty-state">
        <i class="ph-duotone ph-check-circle"></i>
        <h4>Nenhum problema encontrado</h4>
        <p>N칚o h치 problemas de c칩digo para exibir no momento.</p>
        <a href="{% url 'ai_auditor:execute_audit' %}" class="btn-ai btn-ai-primary">
            <i class="ph-duotone ph-play"></i>
            Executar Primeira Auditoria
        </a>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animar contadores das estat칤sticas
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(element => {
        const finalValue = parseInt(element.textContent);
        let currentValue = 0;
        const increment = Math.ceil(finalValue / 20);
        
        const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= finalValue) {
                currentValue = finalValue;
                clearInterval(timer);
            }
            element.textContent = currentValue;
        }, 50);
    });
    
    // Destacar problemas cr칤ticos
    const criticalIssues = document.querySelectorAll('.severity-critical');
    criticalIssues.forEach(issue => {
        issue.closest('.issue-card').style.borderLeftWidth = '4px';
    });
});
</script>
{% endblock %}
