{% extends "pandora_form_ultra_modern.html" %}
{% load static widget_tweaks %}
{% block title %}Edição Completa Funcionário{% endblock %}
{% block page_title %}Edição Completa - {{ object.nome_completo }}{% endblock %}
{% block page_icon %}fas fa-user-cog{% endblock %}
{% block breadcrumbs %}
<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
<li class="breadcrumb-item"><a href="{% url 'funcionarios:funcionario_list' %}">Funcionários</a></li>
<li class="breadcrumb-item"><a href="{% url 'funcionarios:funcionario_detail' object.pk %}">{{ object.nome_completo }}</a></li>
<li class="breadcrumb-item active">Edição Completa</li>
{% endblock %}
{% block form_action_buttons %}
<a href="{% url 'funcionarios:funcionario_detail' object.pk %}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i> Voltar</a>
{% endblock %}
{% block form_content %}
<div class="alert alert-info small">Edite dados principais, dependentes e horários em uma única submissão.</div>
<div class="row">
  <div class="col-lg-7">
    <h5 class="mt-3"><i class="fas fa-id-card me-2"></i>Dados Principais</h5>
    {{ form.non_field_errors }}
    {% for field in form.visible_fields %}
      <div class="mb-2">
        <label class="form-label">{{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}</label>
        {{ field|add_class:"form-control" }}
        {% for e in field.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
      </div>
    {% endfor %}
  </div>
  <div class="col-lg-5">
    <h5 class="mt-3"><i class="fas fa-users me-2"></i>Dependentes</h5>
    {{ dependente_formset.management_form }}
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light"><tr><th>Nome</th><th>Tipo</th><th>IR?</th><th>Remover</th></tr></thead>
      <tbody>
        {% for dform in dependente_formset.forms %}
        <tr>
          <td>{{ dform.nome_completo|add_class:"form-control form-control-sm" }}</td>
          <td>{{ dform.tipo_dependente|add_class:"form-select form-select-sm" }}</td>
          <td>{{ dform.dependente_ir }}</td>
          <td>{% if dform.instance.pk %}{{ dform.DELETE }}{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <h5 class="mt-4"><i class="fas fa-clock me-2"></i>Horários</h5>
    {{ horario_formset.management_form }}
    <table class="table table-sm table-striped">
      <thead class="table-light"><tr><th>Dia</th><th>Entrada</th><th>Saída</th><th>Almoço</th><th>Ativo</th><th>Remover</th></tr></thead>
      <tbody>
        {% for hform in horario_formset.forms %}
        <tr>
          <td>{{ hform.dia_semana|add_class:"form-select form-select-sm" }}</td>
          <td>{{ hform.hora_entrada|add_class:"form-control form-control-sm" }}</td>
          <td>{{ hform.hora_saida|add_class:"form-control form-control-sm" }}</td>
          <td>{{ hform.hora_inicio_almoco|add_class:"form-control form-control-sm" }} {{ hform.hora_fim_almoco|add_class:"form-control form-control-sm mt-1" }}</td>
          <td>{{ hform.ativo }}</td>
          <td>{% if hform.instance.pk %}{{ hform.DELETE }}{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
