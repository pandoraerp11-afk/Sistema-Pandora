{% extends "pandora_home_ultra_modern.html" %}
{% load i18n humanize %}

{# ================= HEADER ================= #}
{% block title %}üßë‚Äçüíº {% trans "M√≥dulo Funcion√°rios" %} - Pandora ERP{% endblock %}
{% block home_icon %}<i class="fas fa-id-badge me-2 text-primary"></i>{% endblock %}
{% block home_title %}{% trans "M√≥dulo Funcion√°rios" %}{% endblock %}
{% block home_subtitle %}{% trans "Central de gest√£o de colaboradores, f√©rias, ponto, benef√≠cios e eventos trabalhistas" %}{% endblock %}

{# ================= STATS ================= #}
{% block home_stats %}
<div class="mb-5">
    <h2 class="section-title" data-aos="fade-up">
        <i class="fas fa-chart-bar me-2 text-primary"></i>
        {% trans "Vis√£o Geral de Funcion√°rios" %}
    </h2>
    <div class="row g-4" data-aos="fade-up" data-aos-delay="100">
        <div class="col-xl-3 col-md-6">
            <a href="{% url 'funcionarios:funcionario_list' %}" class="text-decoration-none">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-primary text-white mx-auto mb-3">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-primary mb-1">{{ total_funcionarios|default:0 }}</h3>
                        <p class="text-muted mb-0 fw-semibold">{% trans "Total" %}</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-xl-3 col-md-6">
            <a href="{% url 'funcionarios:funcionario_list' %}?ativo=true" class="text-decoration-none">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-success text-white mx-auto mb-3">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-success mb-1">{{ funcionarios_ativos|default:0 }}</h3>
                        <p class="text-muted mb-0 fw-semibold">{% trans "Ativos" %}</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-xl-3 col-md-6">
            <a href="{% url 'funcionarios:funcionario_list' %}?ativo=false" class="text-decoration-none">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-secondary text-white mx-auto mb-3">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-secondary mb-1">{{ funcionarios_inativos|default:0 }}</h3>
                        <p class="text-muted mb-0 fw-semibold">{% trans "Inativos" %}</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-xl-3 col-md-6">
            <a href="{% url 'funcionarios:funcionario_list' %}?recent=1" class="text-decoration-none">
                <div class="action-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="action-icon bg-gradient-info text-white mx-auto mb-3">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3 class="display-6 fw-bold text-info mb-1">{{ novos_funcionarios_count|default:0 }}</h3>
                        <p class="text-muted mb-0 fw-semibold">{% trans "Novos (30 dias)" %}</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{# ================= QUICK ACTIONS ================= #}
{% block home_actions %}
<div class="mb-5">
    <h2 class="section-title" data-aos="fade-up">
        <i class="fas fa-bolt me-2 text-primary"></i> {% trans "A√ß√µes R√°pidas" %}
    </h2>
    <div class="row g-4" data-aos="fade-up" data-aos-delay="150">
        <!-- Gest√£o de Funcion√°rios -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#0d6efd">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-primary text-white mx-auto mb-3"><i class="fas fa-user-tie"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Funcion√°rios" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        {% if perms_ui.can_add|default:perms.can_add|default:True %}
                        <a href="{% url 'funcionarios:funcionario_wizard_create' %}" class="btn btn-primary btn-sm"><i class="fas fa-plus me-1"></i>{% trans "Novo" %}</a>
                        {% endif %}
                        {% if perms_ui.can_view|default:perms.can_view|default:True %}
                        <a href="{% url 'funcionarios:funcionario_list' %}" class="btn btn-outline-primary btn-sm"><i class="fas fa-list me-1"></i>{% trans "Listar" %}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- F√©rias -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#198754">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-success text-white mx-auto mb-3"><i class="fas fa-umbrella-beach"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "F√©rias" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a href="{% url 'funcionarios:ferias_list' %}" class="btn btn-outline-success btn-sm"><i class="fas fa-list me-1"></i>{% trans "Ver" %}</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- 13¬∫ Sal√°rio -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#ffc107">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-warning text-white mx-auto mb-3"><i class="fas fa-coins"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "13¬∫ Sal√°rio" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a href="{% url 'funcionarios:decimo_terceiro_list' %}" class="btn btn-outline-warning btn-sm text-dark"><i class="fas fa-list me-1"></i>{% trans "Ver" %}</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Folgas -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#6f42c1">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-secondary text-white mx-auto mb-3"><i class="fas fa-calendar-day"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Folgas" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a href="{% url 'funcionarios:folga_list' %}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-list me-1"></i>{% trans "Ver" %}</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Cart√£o Ponto -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#17a2b8">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-info text-white mx-auto mb-3"><i class="fas fa-stopwatch"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Cart√£o Ponto" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a href="{% url 'funcionarios:cartao_ponto_list' %}" class="btn btn-outline-info btn-sm"><i class="fas fa-list me-1"></i>{% trans "Ver" %}</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Benef√≠cios -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#fd7e14">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-danger text-white mx-auto mb-3"><i class="fas fa-gift"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Benef√≠cios" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <a href="{% url 'funcionarios:beneficio_list' %}" class="btn btn-outline-danger btn-sm"><i class="fas fa-list me-1"></i>{% trans "Ver" %}</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Relat√≥rios (placeholder) -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#20c997">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-success text-white mx-auto mb-3"><i class="fas fa-chart-line"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Relat√≥rios" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <button class="btn btn-success btn-sm" onclick="alert('Relat√≥rios em desenvolvimento')"><i class="fas fa-chart-pie me-1"></i>{% trans "Abrir" %}</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Import/Export (placeholder) -->
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="quick-action-card h-100" style="--accent-color:#343a40">
                <div class="card-body p-4 text-center">
                    <div class="quick-action-icon bg-gradient-dark text-white mx-auto mb-3"><i class="fas fa-file-import"></i></div>
                    <h6 class="fw-semibold mb-2">{% trans "Importa√ß√£o / Exporta√ß√£o" %}</h6>
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                        <button class="btn btn-outline-dark btn-sm" onclick="alert('Em desenvolvimento')"><i class="fas fa-upload me-1"></i>{% trans "Importar" %}</button>
                        <button class="btn btn-dark btn-sm" onclick="alert('Em desenvolvimento')"><i class="fas fa-download me-1"></i>{% trans "Exportar" %}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{# ================= MAIN CONTENT (RECENT + ANIVERSARIANTES + TOP DEPT) ================= #}
{% block home_content %}
<div class="row g-4" data-aos="fade-up">
    <div class="col-lg-7">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0"><i class="fas fa-clock me-2 text-primary"></i>{% trans "Contrata√ß√µes Recentes" %}</h5>
                    {% if perms_ui.can_view|default:perms.can_view|default:True %}
                    <a class="btn btn-sm btn-outline-primary" href="{% url 'funcionarios:funcionario_list' %}"><i class="fas fa-list me-1"></i> {% trans "Ver todos" %}</a>
                    {% endif %}
                </div>
                {% if funcionarios_recentes %}
                    <div class="list-group list-group-flush">
                        {% for f in funcionarios_recentes %}
                        <a href="{% url 'funcionarios:funcionario_detail' f.pk %}" class="list-group-item list-group-item-action px-0 d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ f.nome_completo|truncatechars:32 }}</strong>
                                <small class="text-muted ms-2">{{ f.cargo|default:"-"|truncatechars:28 }}</small>
                            </div>
                            <small class="text-muted">{{ f.data_admissao|date:"d/m/Y" }}</small>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-light border mb-0">{% trans "Sem novas contrata√ß√µes nos √∫ltimos 30 dias." %}</div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card h-100 shadow-sm border-0 mb-4">
            <div class="card-body p-4">
                <h5 class="mb-3"><i class="fas fa-birthday-cake me-2 text-primary"></i>{% trans "Aniversariantes do M√™s" %}</h5>
                {% if aniversariantes_mes %}
                    <ul class="list-group list-group-flush">
                        {% for f in aniversariantes_mes %}
                            <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                <span>{{ f.nome_completo|truncatechars:30 }}</span>
                                <span class="badge-modern bg-light text-dark border"><i class="fas fa-cake-candles me-1"></i>{{ f.data_nascimento|date:"d/m" }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="text-muted small">{% trans "Nenhum aniversariante este m√™s." %}</div>
                {% endif %}
            </div>
        </div>
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body p-4">
                <h5 class="mb-3"><i class="fas fa-sitemap me-2 text-primary"></i>{% trans "Top Departamentos" %}</h5>
                {% if top_departamentos %}
                    {% for d in top_departamentos %}
                        <div class="mb-2">
                            <div class="d-flex justify-content-between small fw-semibold">
                                <span>{{ d.departamento__name|default:"-" }}</span>
                                <span>{{ d.total }}</span>
                            </div>
                            <div class="progress" style="height:6px">
                                <div class="progress-bar bg-primary" style="width: {% widthratio d.total total_funcionarios 100 %}%"></div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-muted small">{% trans "Sem departamentos com funcion√°rios suficientes para ranking." %}</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{# ================= EXTRA JS ================= #}
{% block home_extra_js %}
<script>
// Espa√ßo reservado para futura intera√ß√£o JS espec√≠fica do m√≥dulo de funcion√°rios
</script>
{% endblock %}
