{% extends "pandora_ultra_modern_base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
<style>
    .delete-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid #fecaca;
        overflow: hidden;
        max-width: 600px;
        margin: 0 auto;
    }
    .delete-card .card-header {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #dc2626;
        padding: 2rem;
        border: none;
        text-align: center;
    }
    .delete-card .card-header .icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
    .delete-card .card-header h2 {
        margin: 0;
        font-weight: 700;
    }
    .delete-card .card-header p {
        margin: 0.5rem 0 0 0;
        opacity: 0.8;
    }
    .delete-card .card-body {
        padding: 2rem;
    }
    .warning-box {
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        text-align: center;
    }
    .warning-box .icon {
        font-size: 3rem;
        color: #d97706;
        margin-bottom: 1rem;
    }
    .warning-box h5 {
        color: #92400e;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .warning-box p {
        color: #92400e;
        margin: 0;
    }
    .item-details {
        background: #f8fafc;
        border: 1px solid #e3e9f7;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .item-details h5 {
        color: #374151;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    .item-details .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e5e7eb;
    }
    .item-details .detail-item:last-child {
        border-bottom: none;
    }
    .item-details .detail-label {
        font-weight: 500;
        color: #6b7280;
    }
    .item-details .detail-value {
        color: #374151;
        font-weight: 600;
    }
    .badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        border-radius: 8px;
        font-weight: 500;
    }
    .badge-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    .action-buttons {
        background: #f8fafc;
        padding: 1.5rem 2rem;
        border-top: 1px solid #e3e9f7;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }
    .btn-danger {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        border: none;
        border-radius: 10px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
    }
    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
    }
    .btn-secondary {
        background: #6b7280;
        border: none;
        border-radius: 10px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .btn-secondary:hover {
        background: #4b5563;
        transform: translateY(-2px);
    }
    .consequences-list {
        background: #fef2f2;
        border: 1px solid #fca5a5;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .consequences-list h6 {
        color: #dc2626;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
    }
    .consequences-list ul {
        color: #7f1d1d;
        margin: 0;
        padding-left: 1.5rem;
    }
    .consequences-list li {
        margin-bottom: 0.5rem;
    }
    .loading-state {
        display: none;
    }
    .loading-state.show {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            {% for breadcrumb in breadcrumbs %}
                {% if breadcrumb.active %}
                    <li class="breadcrumb-item active" aria-current="page">
                        <i class="fas fa-chevron-right me-2"></i>{{ breadcrumb.title }}
                    </li>
                {% else %}
                    <li class="breadcrumb-item">
                        {% if breadcrumb.url %}
                            <a href="{{ breadcrumb.url }}" class="text-decoration-none">
                                {{ breadcrumb.title }}
                            </a>
                        {% else %}
                            {{ breadcrumb.title }}
                        {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Delete Card -->
            <div class="delete-card">
                <div class="card-header">                     <div class="icon">
                        <i class="fas fa-exclamation-triangle"></i>
                     </div>
                    <h2>Confirmar Exclusão</h2>
                    <p>{{ page_subtitle }}</p>
                </div>
                
                <div class="card-body">
                    <!-- Warning Box -->
                    <div class="warning-box">                         <div class="icon">
                            <i class="fas fa-shield-alt"></i>
                         </div>
                        <h5>Atenção!</h5>
                        <p>{{ delete_message }}</p>
                        <p class="mt-2"><strong>{{ warning_message }}</strong></p>
                    </div>

                    <!-- Item Details -->
                    <div class="item-details">
                        <h5>
                            <i class="fas fa-info-circle me-2"></i>
                            Detalhes da Unidade de Medida
                        </h5>
                        
                        <div class="detail-item">
                            <span class="detail-label">Nome:</span>
                            <span class="detail-value">{{ unidade.nome }}</span>
                        </div>
                        
                        <div class="detail-item">
                            <span class="detail-label">Símbolo:</span>
                            <span class="detail-value">
                                <span class="badge badge-primary">{{ unidade.simbolo }}</span>
                            </span>
                        </div>
                        
                        <div class="detail-item">
                            <span class="detail-label">Descrição:</span>
                            <span class="detail-value">
                                {% if unidade.descricao %}
                                    {{ unidade.descricao }}
                                {% else %}
                                    <span class="text-muted">Sem descrição</span>
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="detail-item">
                            <span class="detail-label">ID do Sistema:</span>
                            <span class="detail-value">{{ unidade.id }}</span>
                        </div>
                    </div>

                    <!-- Consequences -->
                    <div class="consequences-list">                         <h6>
                            <i class="fas fa-exclamation-diamond me-2"></i>
                             Consequências da Exclusão
                        </h6>
                        <ul>
                            <li>A unidade de medida será removida permanentemente do sistema</li>
                            <li>Todos os produtos que utilizam esta unidade podem ser afetados</li>
                            <li>Relatórios históricos que referenciam esta unidade podem apresentar inconsistências</li>
                            <li>Esta ação não pode ser desfeita</li>
                        </ul>
                    </div>

                    <!-- Loading State -->
                    <div class="loading-state text-center">
                        <div class="spinner-border text-danger" role="status">
                            <span class="visually-hidden">Excluindo...</span>
                        </div>
                        <p class="mt-2 text-muted">Processando exclusão...</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <div>
                        <a href="{{ cancel_url }}" class="btn btn-secondary" id="cancelBtn">
                            <i class="fas fa-arrow-left me-2"></i>Cancelar
                        </a>
                    </div>
                    <div>
                        <form method="post" style="display: inline;" id="deleteForm">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger" id="deleteBtn">
                                <i class="fas fa-trash me-2"></i>Confirmar Exclusão
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForm = document.getElementById('deleteForm');
        const deleteBtn = document.getElementById('deleteBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const loadingState = document.querySelector('.loading-state');
        
        deleteForm.addEventListener('submit', function(e) {
            // Show confirmation dialog
            if (!confirm('Tem certeza absoluta que deseja excluir esta unidade de medida? Esta ação não pode ser desfeita.')) {
                e.preventDefault();
                return false;
            }
            
            // Show loading state
            loadingState.classList.add('show');
            deleteBtn.disabled = true;
            cancelBtn.disabled = true;
            
            // Update button text
            deleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Excluindo...';
            
            // Hide other content
            document.querySelector('.card-body').style.opacity = '0.5';
        });
        
        // Add escape key listener
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.location.href = '{{ cancel_url }}';
            }
        });
        
        // Auto-focus cancel button for safety
        cancelBtn.focus();
    });
    
    // Add shake animation to warning box
    function shakeWarning() {
        const warningBox = document.querySelector('.warning-box');
        warningBox.style.animation = 'shake 0.5s';
        setTimeout(() => {
            warningBox.style.animation = '';
        }, 500);
    }
    
    // Add CSS animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    `;
    document.head.appendChild(style);
    
    // Shake warning on page load
    setTimeout(shakeWarning, 500);
</script>
{% endblock %}
