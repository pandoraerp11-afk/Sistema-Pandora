{% extends "pandora_list_ultra_modern.html" %}
{% load static %}

{% block list_title %}Categorias de Produtos{% endblock %}
{% block page_title %}Categorias{% endblock %}
{% block list_header_title %}Gerenciamento de Categorias{% endblock %}
{% block list_header_subtitle %}Organize e gerencie as categorias dos seus produtos{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
<li class="breadcrumb-item"><a href="{% url 'produtos:produto_list' %}">Produtos</a></li>
<li class="breadcrumb-item active">Categorias</li>
{% endblock %}

{% block action_buttons %}
<a href="{% url 'produtos:categoria_create' %}" class="btn btn-primary btn-modern">
    <i class="fas fa-plus"></i>
    Nova Categoria
</a>
{% endblock %}

{% block stats_cards %}
<div class="row mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stats-card primary">
            <div class="stats-content">
                <div class="stats-number">{{ categorias|length }}</div>
                <div class="stats-label">Total de Categorias</div>
            </div>
            <div class="stats-icon">
                <i class="fas fa-tags"></i>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="stats-card success">
            <div class="stats-content">
                <div class="stats-number">{{ categorias_ativas|default:0 }}</div>
                <div class="stats-label">Categorias Ativas</div>
            </div>
            <div class="stats-icon">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="stats-card warning">
            <div class="stats-content">
                <div class="stats-number">{{ produtos_sem_categoria|default:0 }}</div>
                <div class="stats-label">Produtos Sem Categoria</div>
            </div>
            <div class="stats-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="stats-card info">
            <div class="stats-content">
                <div class="stats-number">{{ categoria_mais_produtos.count|default:0 }}</div>
                <div class="stats-label">Maior Categoria</div>
            </div>
            <div class="stats-icon">
                <i class="fas fa-crown"></i>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block filters %}
<div class="filters-section mb-4">
    <form method="get" class="filters-form">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="busca">Buscar categoria:</label>
                    <input type="text" id="busca" name="busca" class="form-control" 
                           placeholder="Digite o nome da categoria..." 
                           value="{{ request.GET.busca }}">
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label for="ordenacao">Ordenar por:</label>
                    <select id="ordenacao" name="ordenacao" class="form-select">
                        <option value="nome" {% if request.GET.ordenacao == 'nome' %}selected{% endif %}>Nome A-Z</option>
                        <option value="-nome" {% if request.GET.ordenacao == '-nome' %}selected{% endif %}>Nome Z-A</option>
                        <option value="-data_criacao" {% if request.GET.ordenacao == '-data_criacao' %}selected{% endif %}>Mais Recentes</option>
                        <option value="data_criacao" {% if request.GET.ordenacao == 'data_criacao' %}selected{% endif %}>Mais Antigas</option>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <label>&nbsp;</label>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary btn-modern">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <a href="{% url 'produtos:categoria_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i> Limpar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block table_headers %}
<th width="5%">#</th>
<th width="25%">Nome</th>
<th width="35%">Descrição</th>
<th width="15%">Produtos</th>
<th width="10%">Status</th>
<th width="10%">Ações</th>
{% endblock %}

{% block table_rows %}
{% for categoria in categorias %}
<tr>
    <td>
        <div class="item-id">#{{ categoria.id }}</div>
    </td>
    <td>
        <div class="item-title">
            <strong>{{ categoria.nome }}</strong>
        </div>
    </td>
    <td>
        <div class="item-description">
            {{ categoria.descricao|default:"Sem descrição"|truncatechars:80 }}
        </div>
    </td>
    <td>
        <div class="item-badge">
            <span class="badge bg-info">
                <i class="fas fa-boxes"></i>
                {{ categoria.produtos.count }} produto{{ categoria.produtos.count|pluralize }}
            </span>
        </div>
    </td>
    <td>
        {% if categoria.ativo %}
            <span class="status-badge active">
                <i class="fas fa-check-circle"></i> Ativa
            </span>
        {% else %}
            <span class="status-badge inactive">
                <i class="fas fa-times-circle"></i> Inativa
            </span>
        {% endif %}
    </td>
    <td>
        <div class="action-buttons">
            <div class="btn-group" role="group">
                <a href="{% url 'produtos:categoria_update' categoria.pk %}" 
                   class="btn btn-sm btn-outline-primary" 
                   title="Editar categoria">
                    <i class="fas fa-edit"></i>
                </a>
                <a href="{% url 'produtos:categoria_delete' categoria.pk %}" 
                   class="btn btn-sm btn-outline-danger" 
                   title="Excluir categoria"
                   onclick="return confirm('Tem certeza que deseja excluir esta categoria?')">
                    <i class="fas fa-trash"></i>
                </a>
            </div>
        </div>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="6" class="text-center py-4">
        <div class="empty-state">
            <i class="fas fa-tags fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">Nenhuma categoria encontrada</h5>
            <p class="text-muted">Comece criando sua primeira categoria de produtos.</p>
            <a href="{% url 'produtos:categoria_create' %}" class="btn btn-primary btn-modern">
                <i class="fas fa-plus"></i> Criar primeira categoria
            </a>
        </div>
    </td>
</tr>
{% endfor %}
{% endblock %}

{% block extra_modals %}
<!-- Modal para visualização rápida -->
<div class="modal fade" id="quickViewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Visualização Rápida - Categoria</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="quickViewContent">
                    <!-- Conteúdo carregado via AJAX -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Auto-submit do formulário de filtros
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('busca');
    const ordenacaoSelect = document.getElementById('ordenacao');
    
    let timeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
            this.form.submit();
        }, 500);
    });
    
    ordenacaoSelect.addEventListener('change', function() {
        this.form.submit();
    });
});

// Função para visualização rápida (pode ser implementada futuramente)
function quickView(categoriaId) {
    // Implementar AJAX para carregar dados da categoria
    console.log('Quick view para categoria:', categoriaId);
}
</script>
{% endblock %}
