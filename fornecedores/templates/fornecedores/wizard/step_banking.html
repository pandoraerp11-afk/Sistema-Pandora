{% extends 'pandora_wizard_form_ultra_modern.html' %}
{% load widget_tweaks %}

{% block step_content %}
  <div class="row">
    <div class="col-md-4">{% include 'core/wizard/wizard_field.html' with field=forms.main.banco label='Banco' %}</div>
    <div class="col-md-2">{% include 'core/wizard/wizard_field.html' with field=forms.main.agencia label='Agência' %}</div>
    <div class="col-md-3">{% include 'core/wizard/wizard_field.html' with field=forms.main.conta label='Conta' %}</div>
    <div class="col-md-3">{% include 'core/wizard/wizard_field.html' with field=forms.main.tipo_chave_pix label='Tipo de Chave PIX' %}</div>
  </div>
  <div class="row">
    <div class="col-md-6">{% include 'core/wizard/wizard_field.html' with field=forms.main.chave_pix label='Chave PIX' %}</div>
  </div>
  <input type="hidden" id="id_main-additional_bank_json" name="main-additional_bank_json" />
  <div class="mt-3">
    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addBank()"><i class="fas fa-plus"></i> Adicionar Conta</button>
    <div id="bankList" class="mt-2"></div>
  </div>

  <script>
    const bankList = document.getElementById('bankList');
    function addBank(){
      const wrapper = document.createElement('div');
      wrapper.className = 'card card-body mb-2';
      wrapper.innerHTML = `
        <div class="row g-2">
          <div class="col-md-4"><input class="form-control" placeholder="Banco"></div>
          <div class="col-md-2"><input class="form-control" placeholder="Agência"></div>
          <div class="col-md-3"><input class="form-control" placeholder="Conta"></div>
          <div class="col-md-3"><input class="form-control" placeholder="Chave PIX"></div>
          <div class="col-md-2 d-grid"><button class="btn btn-outline-danger" onclick="this.closest('.card').remove(); syncBank()">Remover</button></div>
        </div>`;
      bankList.appendChild(wrapper);
      syncBank();
    }
    function syncBank(){
      const list = [];
      bankList.querySelectorAll('.card').forEach(c => {
        const inputs = c.querySelectorAll('input');
        list.push({ banco: inputs[0].value, agencia: inputs[1].value, conta: inputs[2].value, chave_pix: inputs[3].value });
      });
      document.getElementById('id_main-additional_bank_json').value = JSON.stringify(list);
    }
    bankList?.addEventListener('input', syncBank);
  </script>
{% endblock %}
