{% extends "pandora_list_ultra_modern.html" %}

{% block title %}Relatórios da Agenda{% endblock %}

{% block content_header %}
<div class="container-fluid">
  <div class="row mb-2">
    <div class="col-sm-6">
      <h1><i class="fas fa-chart-line mr-2"></i>{{ titulo|default:'Relatório de Eventos' }}</h1>
    </div>
    <div class="col-sm-6">
      <ol class="breadcrumb float-sm-right">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Início</a></li>
        <li class="breadcrumb-item"><a href="{% url 'agenda:agenda_home' %}">Agenda</a></li>
        <li class="breadcrumb-item active">Relatórios</li>
      </ol>
    </div>
  </div>
</div>
{% endblock %}

{% block list_actions %}
<a href="{% url 'agenda:evento_create' %}" class="btn btn-primary">
  <i class="fas fa-plus"></i> Novo Evento
</a>
<a href="{% url 'agenda:agenda_calendar' %}" class="btn btn-info">
  <i class="fas fa-calendar"></i> Calendário
</a>
<a href="{% url 'agenda:evento_list' %}" class="btn btn-secondary">
  <i class="fas fa-list"></i> Gerenciar
</a>
{% endblock %}

{% block statistics_cards %}
<div class="row">
  <div class="col-lg-3 col-6">
    <div class="small-box bg-primary">
      <div class="inner">
        <h3>{{ total_eventos|default:0 }}</h3>
        <p>Total de Eventos</p>
      </div>
      <div class="icon"><i class="fas fa-calendar-alt"></i></div>
    </div>
  </div>
  <div class="col-lg-3 col-6">
    <div class="small-box bg-success">
      <div class="inner">
        <h3>{{ eventos_realizados|default:0 }}</h3>
        <p>Realizados</p>
      </div>
      <div class="icon"><i class="fas fa-check-circle"></i></div>
    </div>
  </div>
  <div class="col-lg-3 col-6">
    <div class="small-box bg-danger">
      <div class="inner">
        <h3>{{ eventos_cancelados|default:0 }}</h3>
        <p>Cancelados</p>
      </div>
      <div class="icon"><i class="fas fa-times-circle"></i></div>
    </div>
  </div>
  <div class="col-lg-3 col-6">
    <div class="small-box bg-warning">
      <div class="inner">
        <h3>{{ eventos|length }}</h3>
        <p>Filtrados</p>
      </div>
      <div class="icon"><i class="fas fa-filter"></i></div>
    </div>
  </div>
</div>
{% endblock %}

{% block search_form %}
<div class="card card-outline card-primary">
  <div class="card-header">
    <h3 class="card-title"><i class="fas fa-filter mr-1"></i>Filtros</h3>
  </div>
  <div class="card-body">
    <form method="get">
      <div class="row">
        <div class="col-md-3">
          <label>Data início</label>
          <input type="date" name="data_inicio" value="{{ request.GET.data_inicio }}" class="form-control">
        </div>
        <div class="col-md-3">
          <label>Data fim</label>
          <input type="date" name="data_fim" value="{{ request.GET.data_fim }}" class="form-control">
        </div>
        <div class="col-md-3">
          <label>Status</label>
          <select name="status" class="form-control">
            <option value="">Todos</option>
            <option value="pendente" {% if request.GET.status == 'pendente' %}selected{% endif %}>Pendente</option>
            <option value="realizado" {% if request.GET.status == 'realizado' %}selected{% endif %}>Realizado</option>
            <option value="concluido" {% if request.GET.status == 'concluido' %}selected{% endif %}>Concluído</option>
            <option value="confirmado" {% if request.GET.status == 'confirmado' %}selected{% endif %}>Confirmado</option>
            <option value="cancelado" {% if request.GET.status == 'cancelado' %}selected{% endif %}>Cancelado</option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button class="btn btn-primary"><i class="fas fa-search mr-1"></i>Buscar</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block table_content %}
<div class="card">
  <div class="card-body p-0">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Evento</th>
          <th>Data/Hora</th>
          <th>Responsável</th>
          <th>Status</th>
          <th>Prioridade</th>
        </tr>
      </thead>
      <tbody>
        {% for e in eventos %}
        <tr>
          <td><a href="{% url 'agenda:evento_detail' e.pk %}"><strong>{{ e.titulo }}</strong></a></td>
          <td>
            {{ e.data_inicio|date:"d/m/Y H:i" }}
            {% if e.data_fim and not e.dia_inteiro %}<br><small class="text-muted">até {{ e.data_fim|date:"H:i" }}</small>{% endif %}
            {% if e.dia_inteiro %}<br><small class="badge badge-info">Dia inteiro</small>{% endif %}
          </td>
          <td>{% if e.responsavel %}{{ e.responsavel.first_name }} {{ e.responsavel.last_name }}{% else %}<span class="text-muted">—</span>{% endif %}</td>
          <td>
            {% if e.status == 'pendente' %}<span class="badge bg-warning">Pendente</span>
            {% elif e.status == 'realizado' or e.status == 'concluido' %}<span class="badge bg-success">Concluído</span>
            {% elif e.status == 'confirmado' %}<span class="badge bg-info">Confirmado</span>
            {% else %}<span class="badge bg-danger">Cancelado</span>{% endif %}
          </td>
          <td>
            {% if e.prioridade == 'alta' %}<span class="badge bg-danger">Alta</span>
            {% elif e.prioridade == 'media' %}<span class="badge bg-warning">Média</span>
            {% else %}<span class="badge bg-success">Baixa</span>{% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center p-5 text-muted">Nenhum evento encontrado</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
