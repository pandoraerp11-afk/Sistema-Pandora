{% extends "pandora_ultra_modern_base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Detalhes do Formulário: {{ formulario.titulo }}</h3>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">Título:</dt>
                        <dd class="col-sm-9">{{ formulario.titulo }}</dd>

                        <dt class="col-sm-3">Descrição:</dt>
                        <dd class="col-sm-9">{{ formulario.descricao }}</dd>

                        <dt class="col-sm-3">Slug:</dt>
                        <dd class="col-sm-9">{{ formulario.slug }}</dd>

                        <dt class="col-sm-3">Criado por:</dt>
                        <dd class="col-sm-9">{{ formulario.criado_por.username }}</dd>

                        <dt class="col-sm-3">Criado em:</dt>
                        <dd class="col-sm-9">{{ formulario.criado_em }}</dd>

                        <dt class="col-sm-3">Última atualização:</dt>
                        <dd class="col-sm-9">{{ formulario.atualizado_em }}</dd>

                        <dt class="col-sm-3">Status:</dt>
                        <dd class="col-sm-9">{{ formulario.get_status_display }}</dd>

                        <dt class="col-sm-3">Público:</dt>
                        <dd class="col-sm-9">{% if formulario.publico %}Sim{% else %}Não{% endif %}</dd>

                        <dt class="col-sm-3">Requer Login:</dt>
                        <dd class="col-sm-9">{% if formulario.requer_login %}Sim{% else %}Não{% endif %}</dd>

                        <dt class="col-sm-3">Permite Múltiplas Respostas:</dt>
                        <dd class="col-sm-9">{% if formulario.permite_multiplas_respostas %}Sim{% else %}Não{% endif %}</dd>

                        <dt class="col-sm-3">Total de Respostas:</dt>
                        <dd class="col-sm-9">{{ total_respostas }}</dd>
                    </dl>

                    <h4>Campos do Formulário</h4>
                    <a href="{% url 'formularios_dinamicos:campo_create' form_pk=formulario.pk %}" class="btn btn-success btn-sm mb-3">Adicionar Campo</a>
                    {% if campos %}
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>Ordem</th>
                                    <th>Label</th>
                                    <th>Nome</th>
                                    <th>Tipo</th>
                                    <th>Obrigatório</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for campo in campos %}
                                    <tr>
                                        <td>{{ campo.ordem }}</td>
                                        <td>{{ campo.label }}</td>
                                        <td>{{ campo.nome }}</td>
                                        <td>{{ campo.get_tipo_display }}</td>
                                        <td>{% if campo.obrigatorio %}Sim{% else %}Não{% endif %}</td>
                                        <td>
                                            <a href="{% url 'formularios_dinamicos:campo_update' form_pk=formulario.pk campo_pk=campo.pk %}" class="btn btn-info btn-sm">Editar</a>
                                            <form action="{% url 'formularios_dinamicos:campo_delete' form_pk=formulario.pk campo_pk=campo.pk %}" method="post" style="display:inline;">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja excluir este campo?');">Excluir</button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>Nenhum campo adicionado a este formulário ainda.</p>
                    {% endif %}

                    <h4>Respostas Recentes</h4>
                    <a href="{% url 'formularios_dinamicos:resposta_list' form_pk=formulario.pk %}" class="btn btn-primary btn-sm mb-3">Ver Todas as Respostas</a>
                    {% if respostas_recentes %}
                        <table class="table table-bordered table-striped">
                            <thead>
                                <tr>
                                    <th>ID Resposta</th>
                                    <th>Usuário</th>
                                    <th>Status</th>
                                    <th>Enviado em</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for resposta in respostas_recentes %}
                                    <tr>
                                        <td>{{ resposta.pk }}</td>
                                        <td>{{ resposta.usuario.username|default:"Anônimo" }}</td>
                                        <td>{{ resposta.get_status_display }}</td>
                                        <td>{{ resposta.enviado_em }}</td>
                                        <td>
                                            <a href="{% url 'formularios_dinamicos:resposta_detail' form_slug=formulario.slug token=resposta.token %}" class="btn btn-info btn-sm">Ver Detalhes</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>Nenhuma resposta recente para este formulário.</p>
                    {% endif %}

                </div>
                <div class="card-footer">
                    <a href="{% url 'formularios_dinamicos:form_list' %}" class="btn btn-secondary">Voltar para a Lista</a>
                    <a href="{% url 'formularios_dinamicos:form_update' pk=formulario.pk %}" class="btn btn-warning">Editar Formulário</a>
                    <a href="{% url 'formularios_dinamicos:form_render' slug=formulario.slug %}" class="btn btn-success" target="_blank">Visualizar Formulário</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

